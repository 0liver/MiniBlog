@{    
    Layout = "/themes/" + Blog.Theme + "/_layout.cshtml";
    bool showPostList = string.IsNullOrEmpty(Request.QueryString["slug"]);

    // Handle authentication
    if (Request.HttpMethod == "POST")
    { 
        if (!string.IsNullOrEmpty(Request.Form["username"]) && !string.IsNullOrEmpty(Request.Form["password"]))
        {
            FormsAuthentication.Authenticate(Request.Form["username"], Request.Form["password"]);
            FormsAuthentication.SetAuthCookie(Request.Form["username"], true);
            Response.Redirect(Request.RawUrl, true);
        }
        else if (!string.IsNullOrEmpty(Request.QueryString["signout"]))
        {
            FormsAuthentication.SignOut();
            Response.Redirect("~/" + Request.QueryString["slug"], true);
        }
    }
}

@if (showPostList)
{
    Page.Title = Blog.Title;
    @RenderPage("/themes/" + Blog.Theme + "/PostList.cshtml")
}
else
{
    Post post = Post.GetPosts(1).ElementAt(0);
    Page.Title = post.Title + " | " + Blog.Title;   
     
    @RenderPage("/themes/" + Blog.Theme + "/Post.cshtml", post)
}