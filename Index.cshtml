@{
    Page.Title = Blog.Title;
    Page.ShowComments = false;
    Layout = "~/Themes/" + Blog.Theme + "/_layout.cshtml";
    
    bool showPostList = string.IsNullOrEmpty(Request.QueryString["slug"]);
    bool isNewPost = Request.RawUrl.Trim('/') == "post/new";
}

@if (showPostList)
{   
    @RenderPage("~/Themes/" + Blog.Theme + "/PostList.cshtml")
}
else
{
    Post post = new Post();
    
    if (!isNewPost)
    {
        post = Blog.CurrentPost;
        Page.ShowComments = true;
    }
    else if (!User.Identity.IsAuthenticated)
    {
        FormsAuthentication.RedirectToLoginPage();
    }

    if (post == null) { throw new HttpException(404, "Post not found"); }

    Page.Title = post.Title + " | " + Page.Title;

    @RenderPage("~/Themes/" + Blog.Theme + "/Post.cshtml", post)
}

@section scripts{

    @if (!showPostList)
    {
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
        <script src="@Blog.FingerPrint("/scripts/comments.js")" async></script>

        if (User.Identity.IsAuthenticated)
        {
            <script src="@Blog.FingerPrint("/scripts/bootstrap-wysiwyg.js")" async></script>
            <script src="@Blog.FingerPrint("/scripts/admin.js")" async></script>
        }
    }
}

@if (User.Identity.IsAuthenticated)
{
    Page.AdminClass = "admin";
    @RenderPage("~/views/adminmenu.cshtml")
}