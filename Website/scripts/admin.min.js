(function(n){var h,f,i,t,r,w,u,c,e,v,l,o,y=function(){i.attr("contentEditable",!0);t.wysiwyg({hotKeys:{},activeToolbarClass:"active"});t.css({minHeight:"400px"});t.focus();c.attr("disabled",!0);e.attr("disabled",!0);l.removeAttr("disabled");o.removeAttr("disabled");u.removeAttr("disabled");b();n("#tools").fadeIn().css("display","inline-block")},a=function(){f?confirm("Do you want to leave this page?")&&history.back():(i.removeAttr("contentEditable"),t.removeAttr("contentEditable"),o.focus(),c.removeAttr("disabled"),e.removeAttr("disabled"),l.attr("disabled",!0),o.attr("disabled",!0),u.attr("disabled",!0),n("#tools").fadeOut())},b=function(){n(".source").bind("click",function(){var i=n(this);i.attr("data-cmd")==="source"?(i.attr("data-cmd","design"),i.addClass("active"),t.text(t.html())):(i.attr("data-cmd","source"),i.removeClass("active"),t.html(t.text()))})},k=function(r){n(".source").attr("data-cmd")==="design"&&n(".source").click();t.cleanHtml();n.post("/post.ashx?mode=save",{id:h,isPublished:u[0].checked,title:i.text().trim(),content:t.html()}).success(function(n){if(f){location.href=n;return}s(!0,"The post was saved successfully");a(r)}).fail(function(n){n.status===409?s(!1,"The title is already in use"):s(!1,"Something bad happened. Server reported "+n.status+" "+n.statusText)})},p=function(){confirm("Are you sure you want to delete this post?")&&n.post("/post.ashx?mode=delete",{id:h}).success(function(){location.href="/"}).fail(function(){s(!1,"Something went wrong. Please try again")})},s=function(n,t){var i=n?"alert-success":"alert-error";r.addClass(i);r.text(t);r.parent().fadeIn();setTimeout(function(){r.parent().fadeOut("slow",function(){r.removeClass(i)})},4e3)};f=location.pathname.replace(/\//g,"")==="postnew";h=n("[itemprop~='blogPost']").attr("data-id");i=n("[itemprop~='blogPost'] [itemprop~='name']");t=n("[itemprop~='articleBody']");r=n("#admin .alert");w=n("#admin #txtImage");c=n("#btnNew");e=n("#btnEdit").bind("click",y);v=n("#btnDelete").bind("click",p);l=n("#btnSave").bind("click",k);o=n("#btnCancel").bind("click",a);u=n("#ispublished").find("input[type=checkbox]");n(document).keyup(function(n){n.keyCode===46?p():n.keyCode===27&&a()});n(".uploadimage").click(function(t){t.preventDefault();n("#txtImage").click()});f?(y(),n("#ispublished").fadeIn(),u[0].checked=!0):i!==null&&i.length===1&&location.pathname.length>1&&(e.removeAttr("disabled"),v.removeAttr("disabled"),n("#ispublished").fadeIn())})(jQuery);