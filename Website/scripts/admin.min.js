(function(n){var h,f,i,t,r,b,u,c,e,v,l,o,y=function(){i.attr("contentEditable",!0);t.wysiwyg({hotKeys:{},activeToolbarClass:"active"});t.css({minHeight:"400px"});t.focus();c.attr("disabled",!0);e.attr("disabled",!0);l.removeAttr("disabled");o.removeAttr("disabled");u.removeAttr("disabled");g();k();n("#tools").fadeIn().css("display","inline-block")},a=function(){f?confirm("Do you want to leave this page?")&&history.back():(i.removeAttr("contentEditable"),t.removeAttr("contentEditable"),o.focus(),c.removeAttr("disabled"),e.removeAttr("disabled"),l.attr("disabled",!0),o.attr("disabled",!0),u.attr("disabled",!0),nt(),n("#tools").fadeOut(),n(".categoriesControl").fadeOut())},k=function(){n(".source").bind("click",function(){var i=n(this);i.attr("data-cmd")==="source"?(i.attr("data-cmd","design"),i.addClass("active"),t.text(t.html())):(i.attr("data-cmd","source"),i.removeClass("active"),t.html(t.text()))})},d=function(r){n(".source").attr("data-cmd")==="design"&&n(".source").click();t.cleanHtml();n.post("/post.ashx?mode=save",{id:h,isPublished:u[0].checked,title:i.text().trim(),content:t.html(),categories:w()}).success(function(n){if(f){location.href=n;return}s(!0,"The post was saved successfully");a(r)}).fail(function(n){n.status===409?s(!1,"The title is already in use"):s(!1,"Something bad happened. Server reported "+n.status+" "+n.statusText)})},p=function(){confirm("Are you sure you want to delete this post?")&&n.post("/post.ashx?mode=delete",{id:h}).success(function(){location.href="/"}).fail(function(){s(!1,"Something went wrong. Please try again")})},s=function(n,t){var i=n?"alert-success":"alert-error";r.addClass(i);r.text(t);r.parent().fadeIn();setTimeout(function(){r.parent().fadeOut("slow",function(){r.removeClass(i)})},4e3)},w=function(){var t="";return n("#txtCategories").length>0?t=n("#txtCategories").val():n("ul.categories li a").each(function(i,r){t.length>0&&(t+=",");t+=n(r).html()}),t},g=function(){var t=!1,i=w();n("ul.categories li").each(function(i,r){t?n(r).remove():t=!0});n("ul.categories").append("<li><input id='txtCategories' /><\/li>");n("#txtCategories").val(i)},nt=function(){if(n("#txtCategories").length>0){var t=n("#txtCategories").val().split(",");n("#txtCategories").parent().remove();n.each(t,function(t,i){n("ul.categories").append(' <li itemprop="articleSection" title="'+i+'"> <a href="/category/'+encodeURIComponent(i.toLowerCase())+'">'+i+"<\/a> <\/li> ")})}};f=location.pathname.replace(/\//g,"")==="postnew";h=n("[itemprop~='blogPost']").attr("data-id");i=n("[itemprop~='blogPost'] [itemprop~='name']");t=n("[itemprop~='articleBody']");r=n("#admin .alert");b=n("#admin #txtImage");c=n("#btnNew");e=n("#btnEdit").bind("click",y);v=n("#btnDelete").bind("click",p);l=n("#btnSave").bind("click",d);o=n("#btnCancel").bind("click",a);u=n("#ispublished").find("input[type=checkbox]");n(document).keyup(function(n){n.keyCode===46?p():n.keyCode===27&&a()});n(".uploadimage").click(function(t){t.preventDefault();n("#txtImage").click()});f?(y(),n("#ispublished").fadeIn(),u[0].checked=!0):i!==null&&i.length===1&&location.pathname.length>1&&(e.removeAttr("disabled"),v.removeAttr("disabled"),n("#ispublished").fadeIn())})(jQuery);
//# sourceMappingURL=admin.min.js.map